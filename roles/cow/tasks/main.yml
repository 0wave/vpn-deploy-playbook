---
# install & config cow server

- name: install common python packages
  action: apt pkg={{ item }} state=installed
  with_items:
    - python-setuptools
    - python-pip
  tags:
    - cow
    - python


- name: install supervisor
  action: apt pkg={{ item }} state=installed
  with_items:
    - supervisor
  tags:
    - cow
    - python
    - supervisor


- name: install cow
  raw: export COW_INSTALLDIR=/usr/local/bin/; curl -L git.io/cow | bash
  tags:
    - cow


# - name: add backend config
#   template: src=rc-backend.j2 dest="~/.cow/rc"
#   tags:
#     - cow
#     - backend
#   notify:
#     - restart cow


# - name: add frontend config
#   template: src=rc-frontend.j2 dest="~/.cow/rc"
#   tags:
#     - cow
#     - frontend
#   notify:
#     - restart cow


- name: add cow.conf to supervisor
  template: src=cow.conf.j2 dest=/etc/supervisor/conf.d/cow.conf
  tags:
    - cow
  notify:
    - reload supervisor